var custom=new function(){var e=this;e.request=null,e.confirm=function(e,t,r,n){var i;return i=(0,templates["modal/confirm"])($.extend({},!0,{confirm_button:"OK",cancel_button:"Cancel",width:"600px"},n,{title:e,confirm_message:t})),$(window.document.body).append(i),$("#confirmModal").modal({}),$("#confirmModal").on("hidden.bs.modal",function(e){$("#confirmModal").remove()}),$("#confirm_yes").on("click",function(e){return $("#confirm_yes").unbind("click"),$("#confirmModal").modal("hide"),r.call()})},e.ajax=function(t){var r=$.extend({},!0,t);"object"==typeof t&&(t.beforeSend=function(){"function"==typeof r.beforeSend&&r.beforeSend()},t.success=function(e){"function"==typeof r.success&&r.success(e)},null!=e.request&&e.request.abort(),e.request=$.ajax(t))},e.notify=function(e){var t,r,n=$("body");if(n.addClass("bottom-right"),"object"!=typeof e)return!1;for(t in e)r=$.extend({},!0,{type:"success",delay:8e3,text:""},e[t]),void 0!==r.text&&null!=r.text&&$.notify({message:r.text.toString()},{type:r.type,placement:{from:"bottom",align:"right"},z_index:2e3,delay:r.delay,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})},e.sendBtn=function(t,r){if("object"!=typeof r&&(r={}),!t.hasClass("active")){t.addClass("has-spinner");var n=$.extend({},!0,r);n.url=t.attr("href"),$(".spinner",t).remove(),t.prepend('<span class="spinner"><i class="fa fa-spinner fa-spin"></i></span>'),n.beforeSend=function(){t.addClass("active")},n.success=function(n){t.removeClass("active"),$(".spinner",t).remove(),"success"==n.status?"function"==typeof r.callback&&r.callback(n):"error"==n.status&&e.notify({0:{type:"danger",text:n.message}})},e.ajax(n)}},e.sendFrom=function(t,r,n){if("object"!=typeof n&&(n={}),!t.hasClass("active")){t.addClass("has-spinner");var i=$.extend({},!0,n),a=$(".error-summary",r);i.url=r.attr("action"),i.type="POST",$(".spinner",t).remove(),t.prepend('<span class="spinner"><i class="fa fa-spinner fa-spin"></i></span>'),i.beforeSend=function(){t.addClass("active"),a.length&&(a.hide(),a.html(""))},i.success=function(i){t.removeClass("active"),$(".spinner",t).remove(),"success"==i.status?"function"==typeof n.callback&&n.callback(i):"error"==i.status&&(i.message&&(a.length?(a.html(i.message),a.show()):e.notify({0:{type:"danger",text:i.message}})),i.errors&&$.each(i.errors,function(e,t){r.yiiActiveForm("updateAttribute",e,t)}),"function"==typeof n.errorCallback&&n.errorCallback(i))},e.ajax(i)}},e.generatePassword=function(e){void 0===e&&(e=8);var t,r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",n="",i=r.length;for(t=0;t<e;++t)n+=r.charAt(Math.floor(Math.random()*i));return n}},customModule={};window.modules={},$(function(){"object"==typeof window.modules&&$.each(window.modules,function(e,t){void 0!==customModule[e]&&customModule[e].run(t)})}),customModule.layouts={run:function(e){$(document).on("click",".alert .close",function(e){return e.preventDefault(),$(this).parents(".alert").hide(),!1}),$("form").submit(function(e){var t=$(this);if(t.hasClass("submitted"))return e.preventDefault(),!1;t.addClass("submitted")}),e.auth&&setInterval(function(){$.get("/check-auth",function(e){e.isAuth||location.reload()})},12e4)}},customModule.api={run:function(e){$("#service_type").length||$('div[id^="type_"]').show(),$("#service_type").change(function(){$("div[id^='type_']").hide();var e=$("#service_type").val();$("#type_"+e).show()}),$("#service_type").trigger("change")}},customModule.siteOrder={run:function(e){document.forms.sendform.submit()}},customModule.siteHistory={run:function(e){$("#setRefill").on("show.bs.modal",function(e){$("#refill_loader").show(),$("#refill_body").html("");var t=$(this),r=$("form",t);$('input[name="id"]',r).val($(e.relatedTarget).data("href")),$.post(r.attr("action"),r.serialize(),function(e){if("success"==e.status)return location.reload(),!1;"error"==e.status&&($("#refill_loader").hide(),$("#refill_body").html(e.error))})})}},customModule.siteOrder={services:[],fields:[],maxQuantity:0,run:function(e){var t=this;t.services=$.extend({},!0,e.services),t.fields=$.extend({},!0,e.fields),t.currencyOptions=$.extend({},!0,e.currency),t.format=$.extend({},!0,e.format),$(document).on("change","#orderform-category",function(){var e=$(this).val();t.updateServices(e),$("#orderform-service").trigger("change")}),$(document).on("change","#orderform-service",function(){var e=$(this),r=$("option:selected",e).data("type");t.updateFields(r,!0),t.updateDescription()}),$(document).on("keyup",".counter",function(){var e=$(this),r=$("input, textarea",$("#order_"+e.data("related")+".fields"));r.length?(value=e.val(),r.val(value.split("\n").length)):r.val(0),t.updateCharge()}),$(document).on("change","#field-orderform-fields-check",function(){var e=$(this),t=e.attr("id"),r=$('.depend-fields[data-depend="'+t+'"]');e.prop("checked")?r.removeClass("hidden"):r.addClass("hidden")}),function(){var e=$("#orderform-service"),r=$("option:selected",e).data("type");t.updateFields(r,!1),t.updateCharge(),t.updateDescription(),$("#field-orderform-fields-check").trigger("change")}(),$(document).on("keyup","#field-orderform-fields-quantity",function(){t.updateCharge()})},getMaxQuantityValue:function(){var e=this,t=e.getCurrentServicePrice();return 0>=t?Number.MAX_SAFE_INTEGER:parseInt(Number.MAX_SAFE_INTEGER-1/t)},preparePrice:function(e){var t=this,r=t.format,n=r.min,i=e.toString().split(".");void 0!==i[1]&&(i[1]=i[1].replace(/0+$/g,""),i[1].length>n&&(n=r.max<i[1].length?r.max:i[1].length)),e=e.toFixed(n),e=e.replace(/(\d)(?=(\d{3})+\.)/g,"$1"+r.thousands),e=e.replace(/\.(\d+)$/g,r.delimiter+"$1");var a=t.currencyOptions;return e=a.template.replace("{{value}}",e),e=e.replace("{{symbol}}",a.symbol)},getCurrentServicePrice:function(){var e=this,t=$("#orderform-service"),r=e.services[t.val()];return r?r.price:0},getCurrentServiceType:function(){var e=this,t=$("#orderform-service"),r=e.services[t.val()];return r?r.type:0},updateCharge:function(){var e=this,t=$("#charge"),r=$("#charge").parent(".form-group"),n=$("#field-orderform-fields-quantity"),i=$("#orderform-service"),a=e.getMaxQuantityValue();if(r.show(),t.val(e.preparePrice(0)),e.services[i.val()]){var s=e.getCurrentServicePrice(),o=1*e.getCurrentServiceType();if(10==o||14==o)return void t.val(e.preparePrice(1*s));if(100==o)return void r.hide();var d=$.trim(n.val());if(!d||""==d||!d.length||isNaN(d)||!d.match(/^\d+$/gi))return void t.val("");if(d=parseInt(d),isNaN(d))return void t.val("");a<d&&(d=a),s*=d,s/=1e3,t.val(e.preparePrice(s))}},updateServices:function(e){var t=this,r=$("#orderform-service"),n=r.parent(".form-group"),i=[];n.addClass("hidden"),r.html(""),$.each(t.services,function(t,r){void 0!==e&&e!=r.cid||i.push(r)}),i.sort(function(e,t){var r=parseInt(e.position),n=parseInt(t.position);return r<n?-1:r>n?1:0}),$.each(i,function(e,t){r.append($("<option></option>").attr("data-type",t.type).attr("value",t.id).text(t.name))}),$("option",r).length&&n.removeClass("hidden")},updateFields:function(e,t){var r=this,n=$('.fields input[type="text"], .fields textarea, .depend-fields input[type="text"], .depend-fields textarea');n.prop("disabled",!1),n.removeAttr("data-related"),n.removeClass("counter"),$(".fields, .depend-fields").addClass("hidden"),void 0!==r.fields[e]&&($.each(r.fields[e],function(e,t){var r=$("#order_"+t.name+".fields"),n=$("input, textarea",r);if(void 0!==t.disabled&&t.disabled){n.prop("disabled",!0);$("input, textarea",$("#order_"+t.related+".fields")).attr("data-related",t.name).addClass("counter").trigger("keyup")}r.removeClass("hidden"),r.hasClass("has-depends")&&n.trigger("change")}),void 0!==t&&t&&(n.val(""),$('.fields input[type="checkbox"]').prop("checked",!1)),r.updateCharge())},updateDescription:function(){var e=this,t=$("#orderform-service"),r=e.services[t.val()],n=$("#service_description"),i=$("div",n);i.html(""),n.addClass("hidden"),"string"==typeof r.description&&r.description.length&&(i.html(r.description),n.removeClass("hidden"))}},customModule.siteTickets={run:function(e){$("#ticketsend").submit(function(e){e.preventDefault();var t=$("#send"),r=$(this);return!t.hasClass("active")&&(t.addClass("active"),$.post("/ticket-create",r.serialize(),function(e){t.removeClass("active"),"success"==e.status&&($(".ticket-danger").hide(),window.location="/tickets"),"error"==e.status&&($(".ticket-danger div").html(e.error),$(".ticket-danger").show())}),!1)})}};